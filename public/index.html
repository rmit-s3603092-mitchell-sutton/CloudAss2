<!DOCTYPE html>

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="index.css">
        <meta charset="UTF-8">
        <title>Spotify Group Playlist Creator</title>


    </head>
    <body>
        <header>

            <div class = "logo">
            </div>
            <h1>Spotify Group Playlist Creator</h1>
            <p>Log in and add to the playlist</p>
        </header>

        <main>

            <!-- --------------Logged out--------------- -->

            <div id="login">

                <h1>This is an example of the Authorization Code flow</h1>
                <a href="/login" class="btn button">Log in with Spotify</a>

            </div>

            <!-- -------------Logged in---------------- -->

            <div id="loggedin">
                <!-- Add search bar for playlists -->
                <div id="user-profile">
                </div>

                <div id = "choose-playlist">

                    <ul>
                        <li><input type = "text" id = "choose-playlist-input"/></li>
                        <li><button class = "btn" id="choose-playlist-button">Choose Playlist</button></li>
                        <p id = "song-return"></p>
                        <li style = "float: right;"><button class = "btn" id="create-playlist-button">Create Playlist</button></li>
                    </ul>

                </div>

                <hr>

                <!-- -------------home---------------- -->

                <div id = "home">

                    <div id = "back-to-search">
                        <button id = "back-to-search-btn">Back to search</button>
                    </div>
                    <table style = "width: 100%; table-layout: fixed;">
                        <tr>
                            <!-- --------Playlist before search------ -->

                            <td id = "search-before" style = "width: 100%;">
                                <h1>Search:</h1>
                                <input type = "text" id = "search-input"/>
                                <button class = "btn" id="search-button">Search</button>
                                <br>
                            </td> 
                            <!-- --------Playlist after search------ -->

                            <td id = "search-after" style = "width: 100%;"> 
                                <h1>Search result</h1>
                                <h2 id = "search-value"></h2>
                                <select id="search-items" size = "20" style = "width: 100%;">    

                                </select>
                            </td>                
                            <td id = "playlist" style = "width: 100%;">
                                <h1>Playlist</h1>
                                <h2>temporary playlist name</h2>
                                <select id="playlist-items" size = "20" style = "width: 100%;">    

                                </select>
                            </td>
                        </tr>
                    </table>
                    <button class = "btn">Add Song</button>

                </div>

                <div id = "create-playlist">


                </div>


            </div>
        </main>

        <footer>

            <p>Online site by Mitchell Sutton and Jack Moloney</p>

        </footer>

    </body>

    <!-- ----------------Templates------------------ -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js">
    </script>


    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script id="user-profile-template" type="text/x-handlebars-template" src = "template/profile.js">
<div class="media">
    <table>
        <tr>
            <td><img class="media-object" width="150px" src="{{images.0.url}}" /></td>                
            <td><h1>Logged in as {{display_name}}</h1></td>
        </tr>
        <tr>
            <td>Id: </td>
            <td>{{id}}</td>
        </tr>
        <tr>
            <td>Email: </td>
            <td>{{email}}</td>
        </tr>
        </table>

        </div>

    </script>

    <script id="song-template" src = "template/song.js" type="text/x-handlebars-template">
<tr>
    <td>{{name}}, </td>
    <td>{{artists.0.name}}, </td>        
        </tr></script>

</html>


<!-- ----------------Main Script------------------ -->

<script>
    /* ---------- FIREBASE ---------------*/
    firebase.initializeApp({
        credential: admin.credential.applicationDefault()
    });

    var db = firebase.firestore();

    const playlist = document.querySelector("#choose-playlist-input")
    const choosePlaylist = document.querySelector("#choose-playlist-button");
    const song = document.querySelector("#song-return");

    choosePlaylist.addEventListener("click", function(){

        const text = playlist.value;
        const docref = db.doc("playlist/"+ text);

        if(docref && docref.exists){
            const doc = docref.data();
            song.innerText = doc.name;
        }

    });
</script>
<script src = "js/main.js">

</script>
